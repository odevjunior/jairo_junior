{"version":3,"file":"atropos.esm.browser.js.map","sources":["../src/atropos.js"],"sourcesContent":["/* eslint-disable no-restricted-globals */\nconst $ = (el, sel) => el.querySelector(sel);\nconst $$ = (el, sel) => el.querySelectorAll(sel);\nconst $setDuration = (el, duration) => {\n  el.style.transitionDuration = duration;\n};\nconst $setTransform = (el, transform) => {\n  el.style.transform = transform;\n};\nconst $setOpacity = (el, opacity) => {\n  el.style.opacity = opacity;\n};\nconst $on = (el, event, handler, props) => el.addEventListener(event, handler, props);\nconst $off = (el, event, handler, props) => el.removeEventListener(event, handler, props);\n\nconst removeUndefinedProps = (obj = {}) => {\n  const result = {};\n  Object.keys(obj).forEach((key) => {\n    if (typeof obj[key] !== 'undefined') result[key] = obj[key];\n  });\n  return result;\n};\n\nfunction Atropos(originalParams = {}) {\n  let { el, eventsEl } = originalParams;\n\n  const self = {\n    __atropos__: true,\n    params: {\n      activeOffset: 50,\n      shadowOffset: 50,\n      shadowScale: 1,\n      durationEnter: 300,\n      durationLeave: 600,\n      rotateLock: true,\n      rotate: true,\n      rotateTouch: true,\n      rotateXMax: 15,\n      rotateYMax: 15,\n      rotateXInvert: false,\n      rotateYInvert: false,\n      shadow: true,\n      highlight: true,\n      onEnter: null,\n      onLeave: null,\n      onRotate: null,\n      ...removeUndefinedProps(originalParams || {}),\n    },\n    destroyed: false,\n    isActive: false,\n  };\n\n  const { params } = self;\n\n  let rotateEl;\n  let scaleEl;\n  let innerEl;\n\n  let enterRotateX;\n  let enterRotateY;\n\n  let elBoundingClientRect;\n\n  let rotateXLock = true;\n  let rotateYLock = true;\n\n  let shadowEl;\n  let highlightEl;\n\n  const createShadow = () => {\n    let created;\n    shadowEl = $(el, '.atropos-shadow');\n    if (!shadowEl) {\n      shadowEl = document.createElement('span');\n      shadowEl.classList.add('atropos-shadow');\n      created = true;\n    }\n    $setTransform(\n      shadowEl,\n      `translate3d(0,0,-${params.shadowOffset}px) scale(${params.shadowScale})`,\n    );\n    if (created) {\n      rotateEl.appendChild(shadowEl);\n    }\n  };\n  const createHighlight = () => {\n    let created;\n    highlightEl = $(el, '.atropos-highlight');\n    if (!highlightEl) {\n      highlightEl = document.createElement('span');\n      highlightEl.classList.add('atropos-highlight');\n      created = true;\n    }\n\n    $setTransform(highlightEl, `translate3d(0,0,0)`);\n    if (created) {\n      innerEl.appendChild(highlightEl);\n    }\n  };\n\n  const setChildrenOffset = ({\n    rotateXPercentage = 0,\n    rotateYPercentage = 0,\n    duration,\n    opacityOnly,\n  }) => {\n    const getOpacity = (element) => {\n      if (element.dataset.atroposOpacity && typeof element.dataset.atroposOpacity === 'string') {\n        return element.dataset.atroposOpacity.split(';').map((v) => parseFloat(v));\n      }\n      return undefined;\n    };\n    $$(el, '[data-atropos-offset], [data-atropos-opacity]').forEach((childEl) => {\n      $setDuration(childEl, duration);\n      const elementOpacity = getOpacity(childEl);\n      if (rotateXPercentage === 0 && rotateYPercentage === 0) {\n        if (!opacityOnly) $setTransform(childEl, `translate3d(0, 0, 0)`);\n        if (elementOpacity) $setOpacity(childEl, elementOpacity[0]);\n      } else {\n        const childElOffset = parseFloat(childEl.dataset.atroposOffset) / 100;\n        if (!Number.isNaN(childElOffset) && !opacityOnly) {\n          $setTransform(\n            childEl,\n            `translate3d(${-rotateYPercentage * -childElOffset}%, ${\n              rotateXPercentage * -childElOffset\n            }%, 0)`,\n          );\n        }\n        if (elementOpacity) {\n          const [min, max] = elementOpacity;\n          const rotatePercentage = Math.max(\n            Math.abs(rotateXPercentage),\n            Math.abs(rotateYPercentage),\n          );\n          $setOpacity(childEl, min + ((max - min) * rotatePercentage) / 100);\n        }\n      }\n    });\n  };\n\n  const onPointerEnter = (e) => {\n    if (e.type === 'pointerdown' && e.pointerType === 'mouse') return;\n    if (e.type === 'pointerenter' && e.pointerType !== 'mouse') return;\n    if (e.type === 'pointerdown') {\n      e.preventDefault();\n    }\n    el.classList.add('atropos-active');\n    $setDuration(rotateEl, '0ms');\n    enterRotateX = undefined;\n    enterRotateY = undefined;\n    rotateXLock = true;\n    rotateYLock = true;\n    $setTransform(scaleEl, `translate3d(0,0, ${params.activeOffset}px)`);\n    $setDuration(scaleEl, `${params.rotateLock ? params.durationEnter : 0}ms`);\n    if (shadowEl) {\n      $setDuration(shadowEl, `${params.rotateLock ? params.durationEnter : 0}ms`);\n    }\n\n    self.isActive = true;\n    if (typeof params.onEnter === 'function') params.onEnter();\n  };\n\n  const onPointerMove = (e) => {\n    if (!params.rotate || !self.isActive) return;\n    if (e.pointerType !== 'mouse') {\n      if (!params.rotateTouch) return;\n      e.preventDefault();\n    }\n    const { clientX, clientY } = e;\n    if (!elBoundingClientRect) {\n      elBoundingClientRect = el.getBoundingClientRect();\n    }\n    const { top, left, width, height } = elBoundingClientRect;\n    const centerX = width / 2;\n    const centerY = height / 2;\n\n    const coordX = clientX - left;\n    const coordY = clientY - top;\n\n    let rotateY = ((params.rotateYMax * (coordX - centerX)) / (width / 2)) * -1;\n    let rotateX = (params.rotateXMax * (coordY - centerY)) / (height / 2);\n    if (params.rotateLock) {\n      if (typeof enterRotateY === 'undefined') {\n        enterRotateY = rotateY;\n        rotateYLock = true;\n      }\n      if (typeof enterRotateX === 'undefined') {\n        enterRotateX = rotateX;\n        rotateXLock = true;\n      }\n      if (rotateYLock) {\n        if (enterRotateY < 0) {\n          if (rotateY < 0) rotateY = 0;\n          if (rotateY > 0) rotateYLock = false;\n        }\n        if (enterRotateY > 0) {\n          if (rotateY > 0) rotateY = 0;\n          if (rotateY < 0) rotateYLock = false;\n        }\n      }\n      if (rotateXLock) {\n        if (enterRotateX < 0) {\n          if (rotateX < 0) rotateX = 0;\n          if (rotateX > 0) rotateXLock = false;\n        }\n        if (enterRotateX > 0) {\n          if (rotateX > 0) rotateX = 0;\n          if (rotateX < 0) rotateXLock = false;\n        }\n      }\n    }\n\n    rotateX = Math.min(Math.max(-rotateX, -params.rotateXMax), params.rotateXMax);\n    if (params.rotateXInvert) rotateX = -rotateX;\n    rotateY = Math.min(Math.max(-rotateY, -params.rotateYMax), params.rotateYMax);\n    if (params.rotateYInvert) rotateY = -rotateY;\n    $setTransform(rotateEl, `translate3d(0,0,0) rotateX(${rotateX}deg) rotateY(${rotateY}deg)`);\n\n    const rotateXPercentage = (rotateX / params.rotateXMax) * 100;\n    const rotateYPercentage = (rotateY / params.rotateYMax) * 100;\n\n    if (highlightEl) {\n      $setDuration(highlightEl, '0ms');\n      $setTransform(\n        highlightEl,\n        `translate3d(${-rotateYPercentage * 0.25}%, ${rotateXPercentage * 0.25}%, 0)`,\n      );\n      highlightEl.style.opacity =\n        Math.max(Math.abs(rotateXPercentage), Math.abs(rotateYPercentage)) / 100;\n    }\n\n    setChildrenOffset({ rotateXPercentage, rotateYPercentage, duration: '0ms' });\n\n    if (typeof params.onRotate === 'function') params.onRotate(rotateX, rotateY);\n  };\n\n  const onPointerLeave = (e) => {\n    elBoundingClientRect = undefined;\n    if (!self.isActive) return;\n    if (e && e.type === 'pointerup' && e.pointerType === 'mouse') return;\n    if (e && e.type === 'pointerleave' && e.pointerType !== 'mouse') return;\n    el.classList.remove('atropos-active');\n    $setTransform(scaleEl, `translate3d(0,0, ${0}px)`);\n    $setDuration(scaleEl, `${params.durationLeave}ms`);\n    if (shadowEl) {\n      $setDuration(shadowEl, `${params.durationLeave}ms`);\n    }\n    if (highlightEl) {\n      $setDuration(highlightEl, `${params.durationLeave}ms`);\n      $setTransform(highlightEl, `translate3d(0, 0, 0)`);\n      highlightEl.style.opacity = 0;\n    }\n    $setDuration(rotateEl, `${params.durationLeave}ms`);\n    $setTransform(rotateEl, `translate3d(0,0,0) rotateX(0deg) rotateY(0deg)`);\n\n    setChildrenOffset({ duration: `${params.durationLeave}ms` });\n    self.isActive = false;\n    if (typeof params.onRotate === 'function') params.onRotate(0, 0);\n    if (typeof params.onLeave === 'function') params.onLeave();\n  };\n\n  const onDocumentClick = (e) => {\n    const clickTarget = e.target;\n    if (!el.contains(clickTarget) && clickTarget !== el && self.isActive) {\n      onPointerLeave();\n    }\n  };\n\n  const initDOM = () => {\n    if (typeof el === 'string') {\n      el = $(document, el);\n    }\n    if (!el) return;\n\n    // eslint-disable-next-line\n    if (el.__atropos__) return;\n\n    if (typeof eventsEl !== 'undefined') {\n      if (typeof eventsEl === 'string') {\n        eventsEl = $(document, eventsEl);\n      }\n    } else {\n      eventsEl = el;\n    }\n\n    Object.assign(self, {\n      el,\n    });\n\n    rotateEl = $(el, '.atropos-rotate');\n    scaleEl = $(el, '.atropos-scale');\n    innerEl = $(el, '.atropos-inner');\n\n    // eslint-disable-next-line\n    el.__atropos__ = self;\n  };\n\n  const init = () => {\n    initDOM();\n    if (!el || !eventsEl) return;\n    if (params.shadow) {\n      createShadow();\n    }\n    if (params.highlight) {\n      createHighlight();\n    }\n    if (params.rotateTouch) {\n      el.classList.add('atropos-rotate-touch');\n    }\n    if ($(el, '[data-atropos-opacity]')) {\n      setChildrenOffset({ opacityOnly: true });\n    }\n    $on(document, 'click', onDocumentClick);\n    $on(eventsEl, 'pointerdown', onPointerEnter);\n    $on(eventsEl, 'pointerenter', onPointerEnter);\n    $on(eventsEl, 'pointermove', onPointerMove);\n    $on(eventsEl, 'pointerleave', onPointerLeave);\n    $on(eventsEl, 'pointerup', onPointerLeave);\n    $on(eventsEl, 'lostpointercapture', onPointerLeave);\n  };\n\n  const destroy = () => {\n    self.destroyed = true;\n    $off(document, 'click', onDocumentClick);\n    $off(eventsEl, 'pointerdown', onPointerEnter);\n    $off(eventsEl, 'pointerenter', onPointerEnter);\n    $off(eventsEl, 'pointermove', onPointerMove);\n    $off(eventsEl, 'pointerleave', onPointerLeave);\n    $off(eventsEl, 'pointerup', onPointerLeave);\n    $off(eventsEl, 'lostpointercapture', onPointerLeave);\n    // eslint-disable-next-line\n    delete el.__atropos__;\n  };\n\n  self.destroy = destroy;\n\n  init();\n\n  // eslint-disable-next-line\n  return self;\n}\nexport { Atropos };\nexport default Atropos;\n"],"names":["$","el","sel","querySelector","$$","querySelectorAll","$setDuration","duration","style","transitionDuration","$setTransform","transform","$setOpacity","opacity","$on","event","handler","props","addEventListener","$off","removeEventListener","removeUndefinedProps","obj","result","Object","keys","forEach","key","Atropos","originalParams","eventsEl","self","__atropos__","params","activeOffset","shadowOffset","shadowScale","durationEnter","durationLeave","rotateLock","rotate","rotateTouch","rotateXMax","rotateYMax","rotateXInvert","rotateYInvert","shadow","highlight","onEnter","onLeave","onRotate","destroyed","isActive","rotateEl","scaleEl","innerEl","enterRotateX","enterRotateY","elBoundingClientRect","rotateXLock","rotateYLock","shadowEl","highlightEl","createShadow","created","document","createElement","classList","add","appendChild","createHighlight","setChildrenOffset","rotateXPercentage","rotateYPercentage","opacityOnly","getOpacity","element","dataset","atroposOpacity","split","map","v","parseFloat","undefined","childEl","elementOpacity","childElOffset","atroposOffset","Number","isNaN","min","max","rotatePercentage","Math","abs","onPointerEnter","e","type","pointerType","preventDefault","onPointerMove","clientX","clientY","getBoundingClientRect","top","left","width","height","centerX","centerY","coordX","coordY","rotateY","rotateX","onPointerLeave","remove","onDocumentClick","clickTarget","target","contains","initDOM","assign","init","destroy"],"mappings":"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"}